<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <meta name="description" content="TypingFantasy is a fun typing game made with ES6 Javascript and HTML5 Canvas">
        <title>Typing Fantasy</title>
        <link rel="icon" type="image/png" href="/src/Blue_Imp.png">
        <script src="./dist/main.js" defer></script> 
        <meta property="og:url" content="http://cryptic-escarpment-31838.herokuapp.com/" />
        <meta property="og:type" content="website" />
        <meta property="og:title" content="Typing Fantasy" />
        <meta property="og:description" content="TypingFantasy is a fun typing game made with ES6 Javascript and HTML5 Canvas" />
        <meta property="og:image" content="http://cryptic-escarpment-31838.herokuapp.com/Blue_Imp.png" />



        <style>
            img{
                display: none;
            }
            
            @font-face {
                font-family:'ChronoType';
                src:url('src/chronotype/ChronoType.eot');
                src:url('src/chronotype/ChronoType.eot?#iefix') format('embedded-opentype'),
                    url('src/chronotype/ChronoType.woff') format('woff'),
                    url('src/chronotype/ChronoType.ttf') format('truetype'),
                    url('src/chronotype/ChronoType.svg#ChronoType') format('svg');
                font-weight:normal;
                font-style:normal;
            }

            * {
                margin: 0;
                padding: 0;
                border: 0; 
                font-family:ChronoType;
                                box-sizing: border-box;

            }

            #canvas{
                /* width: 1500px;  */
                border: 2px solid silver;
                border-radius: 5px;

            }

            body{
                text-align: center;
                background: antiquewhite;
                background-image: url('/src/520448.jpg'); 
                background-size: cover;"
            }

            html, body {
                min-height: 100%;
            }

            #instructions{
                margin: auto;
                background-image: linear-gradient(#736c72,#C0C0C0);
                width: 800px;
                padding: 20px;
                /* border: 2px solid black; */
                user-select: none;
                color: antiquewhite;
                font-size: 20px;    
                border: 2px solid silver;
                border-radius: 5px; 
            }

            #contact{
                         
            }
            
            .child{
                color:antiquewhite; 
                text-decoration: none;
            }

            a {
                text-decoration: none;
                color:black;
            }
 
            #Title{
                margin-top: 1.5%;
                margin-bottom: 1.5%;
            }

            #sprites {
                /* position: absolute; */
                /* display: block; */
                /* clip: rect(250px, 110px, 310px, 80px); */
                /* top righ bot left */

                /* top is 250 */
                /* bot is 310 */
                /* 80 110 */
            }

            audio {
                width: 14rem;
                height: 2.5rem;
            }
            
            #canvas {
                width: 800px;
                height: 600px;               
            }

            [id^="phone"] {
                display: none;
            }

            @media only screen and (min-width: 1280px) and (min-height: 720px) {
               /* tbd */
            } 

            @media only screen and (max-height: 720px) {
                #canvas, #instructions {
                    max-width: 300px;
                    max-height: 500px;                   
                }
                /* reasoning is to avoid sprites being too large; map isn't changed ** MIGHT NOT BE WORKING because of default canvas load **  */
                img:not(#bg){
                    max-width: 30px;
                    max-height: 30px;
                }
                /* the input to activate the phone's soft keyboard appears so body's keypress listener can be used*/ 
                [id^="phone"] {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
            }
            
        </style>
        <img src="/src/Blue_Imp.png" id="imp">
        <img src="/src/ChronoTrigger1000GuardiaForestBG.png" id="forest">
        <img src="/src/cronobattleleft.gif" id="cronoleft">
        <img src="/src/cronobattleright.gif" id="cronoright">
        <img src="/src/cronobattledown.gif" id="cronodown">
        <img src="/src/cronobattleup.gif" id="cronoup">
        <img src="/src/cronobattleup.gif" id="cronoup">
        <img src="/src/cronodownthrust.gif" id="cronothrust">
        <img src="/src/blue.png" id="bluepaint">
        <img src="/src/chrono.gif" id="sprites">
        <img src="/src/520448.jpg" id="bg">
        <img src="/src/splash.jpg" id="splash">
        <img src="/src/squarereticle.png" id="squarereticle">
        <img src="/src/cursor.png" id="cursor">

    </head>

    <body>
        
        <h1 id="Title">
            <ruby>
                <rb>TYPING FANTASY</rb>
                <rp>(</rp>
                <rt>打字幻想</rt>
                <rp>)</rp>
            </ruby>
        </h1>

        <canvas id="canvas" width=800px height=600 tabindex="1"></canvas>
            <!-- to be able to type on a smartphone's onscreen keyboard but not autozoom the input from it being 16px-->
        <div id="phone-input" style="font-size:17px;"
            onClick="(function(){document.querySelector(`#phone-keyboard`).focus();})();">
                <input type='text' id='phone-keyboard'>↵Keyboard
        </div>

        <div id="instructions">Instructions: 
            <p>1. Type the word above the monster's head to attack it!</p>
            <p>2. Press space to pause/unpause. </p>


            <div id="cheat-tooltip" onmouseover="this.nextElementSibling.style.display='block'"
                onmouseout="this.nextElementSibling.style.display='none'">
            <!-- <div id="cheat-tooltip" onmouseover="this.nextElementSibling.style.visibility='visible'" 
            onmouseout="this.nextElementSibling.style.visibility='hidden'"> -->
                3. Activate cheats if you're so inclined!
            </div>

            <div id="cheat-tooltiptext">
                <p>&bull;Hover over my Email link to add 50% to the monster spawn rate (repeatable)</p>
                <p>&bull;Click my Linkedin link to halve the monster spawn rate (repeatable)</p>
                <p>&bull;Type and enter my first name, edward, to activate infinite health</p>
            </div>

            <br>
            <audio controls id="myAudio" preload="auto">
                <source src="/src/TechnodeChocobo.mp3" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>

        </div>

<!--         
          -->

        <div id="contact" style="font-size:2.5rem; 
        /* bottom: 500px; */
        position: absolute;
        /* margin-top: 50px; */
        bottom: 2px;
        left:50%;
        transform: translate(-50%);

        ">
            <!-- target=_blank is because game progress would be lost otherwise; the phone# is from google -->
                <a href="https://www.linkedin.com/in/edzhou/" tabindex="-1" target="_blank"> My Linkedin</a>&nbsp;|&nbsp;
                <a href="https://github.com/featurerich1/" tabindex="-1" target="_blank">My Github</a>&nbsp;|&nbsp;
                <a href="mailto:edward@utexas.edu" tabindex="-1" target="_blank">Email me!</a>
                <!-- &nbsp;|&nbsp; -->
                <!-- <a href="tel:281-401-9473" tabindex="-1" target="_blank">Call me</a>‪ -->
        </div>


        <!-- <input type="file" accept=".csv"> maybe accept csv or arrays or something just set window.game.dictionary=[array of ur choosing] set with my js</input>
        <button primary value="z">asdf</button> -->
 
        <!-- use 9007199254740997n instead of inf if users viewport is 5000 res or somethign funny-->
     
        <div title="High Score Table" id="highscore" style="
            font-weight: 400;
            line-height: 2rem;
            font-size: 1.5rem;
            color: black;
            opacity: 0.66;
            z-index: 11;
            -moz-user-select: initial;
            background-color: lightblue;
            box-shadow: rgba(69, 74, 99, 0.3) -1px -1px 0px 0px;
            backdrop-filter: blur(15px);
            text-align: left;
            padding: 20px;
            margin-left: 20px;
            border: 2px solid silver;
            border-radius: 5px;
            "> 
            <!-- Load Facebook SDK for JavaScript -->
            <div id="fb-root"></div>
            <script async defer crossorigin="anonymous"
                src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0"></script>
            
            <!-- Your like button code -->
            <div class="fb-like" data-href="http://cryptic-escarpment-31838.herokuapp.com/" data-colorscheme="dark"
                data-layout="standard" data-action="like" data-share="true" width="180px" style="margin-bottom: 10px;
                pointer-events:all
                ">
            </div>

            <h1 PRIMARY data-hi = "5" bye='123'> High Scores  </h1> 
            <!-- tbd: I want to test reflectivity of html attrs -->
        </div>

            <script>
                // all functions defined here attach to window object
                try {
                    const tooltipStyle = {
                        position: `relative`,
                        display: `inline-block`,
                    }

                    const tooltiptextStyle = {
                        ...tooltipStyle,
                        // visibility: `hidden`,
                        display: `none`,
                        // width: `150px`,
                        backgroundColor: `black`,
                        color: `#fff`,
                        textAlign: `left`,
                        borderRadius: `6px`,
                        padding: `5px 0`,
                        /* Position the tooltip */
                        position: `absolute`,
                        zIndex: `1`,
                    }

                    Object.assign(document.querySelector(`#cheat-tooltiptext`).style, tooltiptextStyle)
                    Object.assign(document.querySelector(`#cheat-tooltip`).style, tooltipStyle)

                } catch (err) {
                    alert(err)
                }

                                    
                const ensureSorted = (scores) => {
                    const sorted = scores.sort( (a, b) => b[0] - a[0] )

                    return ({
                        sorted,
                        'noInconsistency': ( JSON.stringify(sorted) === JSON.stringify(scores) )
                    })
                }
                //aliasing while object destrucing: as for import and : for const {} expression; how about params? DONT THINK can alias in params only set defArg
                const createScoreTable = function (scores) {
                    const { noInconsistency: noInconsistency, sorted } = ensureSorted(scores)
                    if ( !noInconsistency) throw `high scores' broken`
                    const textNode = document.createTextNode.bind(document)
                    const lineBreak = () => document.createElement(`br`)
                    const table = document.querySelector(`#highscore`)

                    for (let [index, [score, name]] of Object.entries(scores) ) {
                        table.appendChild(
                            textNode(`${++index}. ${name} scored ${score}`)
                        )
                        table.appendChild(lineBreak())
                    }
                    table.style.position = `absolute`
                    attachTableToCanvasRight(table)
                }; 

                const attachTableToCanvasRight = (table, yetToAttach = true) => {
                    const canvas = document.getElementById(`canvas`)
                    table.style.left =  10 + canvas.getBoundingClientRect().right+`px`
                    table.style.top = canvas.getBoundingClientRect().y+`px`
                    if (yetToAttach) window.addEventListener('resize', () => attachTableToCanvasRight(table, false) );
                }

                const deleteScores = () => {
                    const table = document.querySelector(`#highscore`)
                    table.innerHTML = table.innerHTML.split(`</h1>`)[0]

                    // let child = table.lastElementChild;
                    // while (child && table.children.length > 1) {
                    //     table.removeChild(child);
                    //     child = table.lastElementChild;
                    // } 
                    // table.innerHTML = 
                }
                // (async function fetchScores(){
                //     let data
                //     const defaultData = Object.freeze({ "highScores": [[123, "Edward"], [50, "John"], [30, "Crono"], [25, "Scala"], [15, "Robo"]] })
                //     try {
                //         data = await fetch(`./highscore`).then(res => res.json()) // res is a response object and running res.json() returns a promsie on the body stream is async so cant access res
                //     } catch (err) {
                //         console.log(err)
                //         data = defaultData
                //     } finally {
                //         createScoreTable(data)
                //     }
                // })();
                async function fetchScores() {
                    let data
                    const defaultData = Object.freeze([[123, "Edward"], [50, "John"], [30, "Crono"], [25, "Scala"], [15, "Robo"]])
                    try {
                        data = await fetch(`./highscore`).then(res => res.json()) // res is a response object and running res.json() returns a promsie on the body stream is async so cant access res
                    } catch (err) {
                        console.log(err)
                        data = defaultData
                    } finally {
                        createScoreTable(data)
                    }
                };

                fetchScores()

            //  this may be useless 
                function destroyerOfObjects(){
                    for (let prop in window.game) {
                        eval(`delete window.game.${prop}`)
                    }
                    console.log(window.game)
                }
            </script> 




       

    </body>
</html>